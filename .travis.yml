language: node_js
node_js:
  - "8"
  - "9"
  - "10"
sudo: false
env:
  - COGNITE_PROJECT=cognitesdk-js
install:
  - yarn
  - npm install -g codecov
script:
  - yarn commitlint-travis
  - yarn validateDocLinks
  - yarn lint
  - yarn build
  - yarn test --maxWorkers=1 && codecov
  - yarn test-samples
  - yarn test-snippets
before_deploy:
  - yarn docs
deploy:
  - provider: script
    node_js: lts/*
    on:
      branch: v1
    skip_cleanup: true
    script:
      - node_version=$(node -v); if [ ${node_version:1:2} = 10 ]; then npx semantic-release; else echo "node_version != 10. skip"; fi
  - provider: pages
    skip_cleanup: true
    github_token: $GITHUB_TOKEN
    keep_history: true
    local_dir: docs
    on:
      branch: v1
after_deploy:
  - sudo add-apt-repository -y ppa:cpick/hub
  - sudo apt-get -y update
  - sudo apt-get install -y hub
  - sudo apt-get install -y jq
  - sh scripts/afterRelease.sh
