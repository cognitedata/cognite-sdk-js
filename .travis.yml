language: node_js
cache: yarn
node_js:
  - "10"
  - "12"
  - "14"
env:
  - COGNITE_PROJECT=cognitesdk-js
install:
  - yarn
  - yarn global add codecov
  - sudo apt-get install sed
script:
  - yarn commitlint-travis
  - yarn validateDocLinks
  - yarn lint
  - yarn build
  - yarn test && codecov
  - yarn test-samples
  - yarn test-snippets
before_deploy:
  - yarn bundle-docs
deploy:
  - provider: script
    node_js: lts/*
    on:
      branch: v1
      branch: refactor/lerna-with-samples
      node_js: "14"
    skip_cleanup: true
    script: bash scripts/versionAndPush.sh
  - provider: pages
    skip_cleanup: true
    github_token: $GITHUB_TOKEN
    keep_history: true
    local_dir: docs
    on:
      branch: v1
      node_js: "14"
# after_deploy:
#   - sudo add-apt-repository -y ppa:cpick/hub
#   - sudo apt-get -y update
#   - sudo apt-get install -y hub
#   - sudo apt-get install -y jq
#   - sh scripts/afterRelease.sh
