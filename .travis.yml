language: node_js

# On the latest version of node we do everything
# This is the version that gets deployed if of branch
# On old version of node, we only run tests
jobs:
  include:
  - node_js: "8"
    env: ONLY_TEST="true"
  - node_js: "10"
    env: ONLY_TEST="true"
  - node_js: "12"
    env: ONLY_TEST="true"
  - node_js: "14"
    env: DEPLOY_BUILD="true"

env:
  - COGNITE_PROJECT=cognitesdk-js

install: skip
script: bash scripts/ciScript.sh

deploy:
  - provider: script
    on:
      branch: v1
      branch: refactor/lerna-with-samples
      condition: $DEPLOY_BUILD = true
    skip_cleanup: true
    script: bash scripts/versionAndPush.sh
  - provider: pages
    skip_cleanup: true
    github_token: $GITHUB_TOKEN
    keep_history: true
    local_dir: docs
    on:
      branch: v1
      condition: $DEPLOY_BUILD = true
# after_deploy:
#   - sudo add-apt-repository -y ppa:cpick/hub
#   - sudo apt-get -y update
#   - sudo apt-get install -y hub
#   - sudo apt-get install -y jq
#   - sh scripts/afterRelease.sh
